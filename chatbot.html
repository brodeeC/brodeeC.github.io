<!DOCTYPE html>
<html>
<head>
    <title>Chatbot</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="mainContent">
        <a href="index.html">Home</a>
        <h1>Chatbot</h1>
        <input type="text" id="apiKeyInput" placeholder="Enter your OpenAI API Key">
        <button id="saveApiKeyButton">Save API Key</button>
        <br><br>
        <div id="chatContainer">
            <div id="chatMessages"></div>
        </div>
        <br>
        <input type="text" id="userInput" placeholder="Type your message here...">
        <button id="sendButton">Send</button>
    </div>
    <script>
        let apiKey = localStorage.getItem('openaiApiKey') || '';
        document.getElementById('apiKeyInput').value = apiKey;
        document.getElementById('saveApiKeyButton').onclick = function() {
            apiKey = document.getElementById('apiKeyInput').value;
            localStorage.setItem('openaiApiKey', apiKey);
            alert('API Key saved!');
        };

        document.getElementById('sendButton').onclick = async function() {
            const userInput = document.getElementById('userInput').value;
            if (!userInput) return;
            appendMessage('User', userInput);
            document.getElementById('userInput').value = '';

            if (!apiKey) {
                appendMessage('Bot', 'Please enter your OpenAI API key.');
                return;
            }

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4.1-mini', 
                        messages: [{ role: 'user', content: userInput }]
                    })
                });
                const data = await response.json();
                if (data.choices && data.choices.length > 0) {
                    const botMessage = data.choices[0].message.content;
                    appendMessage('Bot', botMessage);
                } else {
                    appendMessage('Bot', 'No response from API.');
                }
            } catch (error) {
                appendMessage('Bot', 'Error: ' + error.message);
            }
        };

        function appendMessage(sender, message) {
            const chatMessages = document.getElementById('chatMessages');
            const messageElement = chatMessages.createElement('div');
            messageElement.innerHTML = ''; 
            const strong = document.createElement('strong');
            strong.textContent = sender + ':';        
            messageElement.appendChild(strong);
            messageElement.appendChild(document.createTextNode(' ' + message));
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    </script>
</body>
</html>