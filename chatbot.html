<!DOCTYPE html>
<html>
<head>
    <title>Chatbot</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="mainContent">
        <a href="index.html">Home</a>
        <h1>Chatbot</h1>
        <!-- Enter OpenAPI Key -->
        <input type="text" id="apiKeyInput" placeholder="Enter your OpenAI API Key">
        <button id="saveApiKeyButton">Save API Key</button>
        <br><br>
        <!-- Chat Interface -->
        <div id="chatContainer">
            <div id="chatMessages"></div>
        </div>
        <br>
        <input type="text" id="userInput" placeholder="Type your message here...">
        <button id="sendButton">Send</button>
    </div>
    <!-- JavaScript to handle chat functionality -->
    <script>
        import OpenAI from "openai";
        const client = new OpenAI();

        let apiKey = localStorage.getItem('openaiApiKey') || '';
        document.getElementById('apiKeyInput').value = apiKey;  
        document.getElementById('saveApiKeyButton').onclick = function() {
            apiKey = document.getElementById('apiKeyInput').value;
            localStorage.setItem('openaiApiKey', apiKey);
            alert('API Key saved!');
        };
        document.getElementById('sendButton').onclick = async function() {
            const userInput = document.getElementById('userInput').value;
            if (!userInput) return;
            appendMessage('User', userInput);
            document.getElementById('userInput').value = '';
            const response = await client.responses.create({ 
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-4.1-mini',
                    messages: [{ role: 'user', content: userInput }]
                })
            });
            const data = await response.json();
            const botMessage = data.choices[0].message.content;
            appendMessage('Bot', botMessage);
        };
        function appendMessage(sender, message) {
            const chatMessages = document.getElementById('chatMessages');
            const messageElement = document.createElement('div');
            messageElement.innerHTML = `<strong>${sender}:</strong> ${message}`;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    </script>
</body>
</html>